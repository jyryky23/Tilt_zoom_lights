

<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <title>Osvětlení – Tilt & Zoom Kalkulačka (finální)</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #1e1e2f;
            color: #f0f0f0;
        }
        h1, h2 {
            color: #f9c74f;
        }
        label, input, button {
            display: block;
            margin: 10px 0;
            font-size: 1rem;
        }
        input, button {
            padding: 8px;
            border: none;
            border-radius: 5px;
        }
        input {
            width: 100%;
            max-width: 300px;
        }
        button {
            background-color: #577590;
            color: white;
            cursor: pointer;
        }
        button:hover {
            background-color: #495867;
        }
        .result {
            margin: 10px 0;
            font-weight: bold;
            color: #90be6d;
        }
        canvas {
            margin-top: 30px;
            border: 1px solid #ccc;
            background: #fff;
            display: block;
        }
    
        @media (max-width: 600px) {
            body {
                padding: 10px;
            }
            input {
                width: 100%;
            }
            canvas {
                width: 100% !important;
                height: auto !important;
            }
        }
    </style>

</head>
<body>
    <h1>Tilt & Zoom Kalkulačka pro Světla</h1>

    <label for="input_height">Výška světla (m):</label>
    <input type="number" id="input_height" step="0.1">

    <h2>Tilt (náklon)</h2>
    <label for="input_distance">Vzdálenost cíle (m):</label>
    <input type="number" id="input_distance" step="0.1">
    <label for="input_tilt">NEBO zadej úhel tilt přímo (°):</label>
    <input type="number" id="input_tilt" step="0.1">

    <h2>Zoom</h2>
    <label for="input_zoom">Zadej zoom úhel (°):</label>
    <input type="number" id="input_zoom" step="0.1">
    <label for="measured_height">NEBO zadej výšku měření (m):</label>
    <input type="number" id="measured_height" step="0.1">
    <label for="measured_diameter">a naměřený průměr kuželu (m):</label>
    <input type="number" id="measured_diameter" step="0.1">

    <button onclick="calculateCombined()">Spočítat a vykreslit</button>

    <p class="result" id="tilt_result"></p>
    <p class="result" id="zoom_result"></p>

    <canvas id="beamCanvas" width="800" height="400"></canvas>

    <script>
        function calculateCombined() {
            const h = parseFloat(document.getElementById("input_height").value);
            const d = parseFloat(document.getElementById("input_distance").value);
            const tiltInput = parseFloat(document.getElementById("input_tilt").value);
            const zoomInput = parseFloat(document.getElementById("input_zoom").value);

            const zmHeight = parseFloat(document.getElementById("measured_height").value);
            const zmDiameter = parseFloat(document.getElementById("measured_diameter").value);

            let tilt = tiltInput;
            if (!tilt && h > 0 && d > 0) {
                tilt = Math.atan(h / d) * 180 / Math.PI;
            }

            let zoom = zoomInput;
            if (!zoom && zmHeight > 0 && zmDiameter > 0) {
                zoom = 2 * Math.atan((zmDiameter / 2) / zmHeight) * 180 / Math.PI;
            }

            let zoomSpread = null;
            if (h > 0 && zoom > 0 && tilt !== null && tilt !== undefined) {
                const tiltRad = tilt * Math.PI / 180;
                const beamLength = h / Math.cos(tiltRad); // Délka světelného paprsku
                const zoomRad = (zoom / 2) * Math.PI / 180;
                zoomSpread = 2 * beamLength * Math.tan(zoomRad);
            }

            if (tilt) {
                document.getElementById("tilt_result").textContent = `Tilt úhel: ${tilt.toFixed(1)}°`;
            } else {
                document.getElementById("tilt_result").textContent = "Tilt úhel: neznámý (zadej hodnoty)";
            }

            if (zoomSpread !== null) {
                document.getElementById("zoom_result").textContent = `Průměr kuželu na podlaze (tilt ${tilt.toFixed(1)}°): ${zoomSpread.toFixed(2)} m`;
            } else {
                document.getElementById("zoom_result").textContent = "Zoom: neznámý (zadej úhel nebo změřený průměr)";
            }

            drawBeam(h, tilt, zoom);
        }

        function drawBeam(height, tilt, zoom) {
            const canvas = document.getElementById("beamCanvas");
            const ctx = canvas.getContext("2d");
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Základní nastavení
            const scale = 50; // 1 m = 50 px
            const originX = 100;
            const groundY = 350;

            // Pozadí
            ctx.fillStyle = "#fff";
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Podlaha
            ctx.strokeStyle = "#999";
            ctx.beginPath();
            ctx.moveTo(0, groundY);
            ctx.lineTo(canvas.width, groundY);
            ctx.stroke();

            // Konstrukce
            ctx.strokeStyle = "#555";
            ctx.beginPath();
            ctx.moveTo(originX, groundY);
            ctx.lineTo(originX, groundY - height * scale);
            ctx.stroke();

            // Světlo (obdélník)
            const lightY = groundY - height * scale;
            ctx.fillStyle = "#000";
            ctx.fillRect(originX - 5, lightY - 5, 10, 10);

            // Tilt paprsek
            if (tilt) {
                const tiltRad = tilt * Math.PI / 180;
                const x2 = originX + Math.cos(tiltRad) * height * scale;
                const y2 = lightY + Math.sin(tiltRad) * height * scale;

                ctx.strokeStyle = "red";
                ctx.beginPath();
                ctx.moveTo(originX, lightY);
                ctx.lineTo(x2, y2);
                ctx.stroke();
            }

            // Zoom kužel
            if (zoom && tilt !== null) {
                const tiltRad = tilt * Math.PI / 180;
                const beamLength = height / Math.cos(tiltRad) * scale;
                const zoomRad = (zoom / 2) * Math.PI / 180;

                const spread = Math.tan(zoomRad) * beamLength;

                const endX = originX + Math.cos(tiltRad) * beamLength;
                const endY = lightY + Math.sin(tiltRad) * beamLength;

                const leftX = endX + Math.cos(tiltRad + Math.PI / 2) * spread;
                const leftY = endY + Math.sin(tiltRad + Math.PI / 2) * spread;

                const rightX = endX + Math.cos(tiltRad - Math.PI / 2) * spread;
                const rightY = endY + Math.sin(tiltRad - Math.PI / 2) * spread;

                ctx.strokeStyle = "blue";
                ctx.beginPath();
                ctx.moveTo(originX, lightY);
                ctx.lineTo(leftX, leftY);
                ctx.moveTo(originX, lightY);
                ctx.lineTo(rightX, rightY);
                ctx.stroke();
            }

            // Osy
            ctx.fillStyle = "#000";
            for (let i = 0; i <= 10; i++) {
                let x = originX + i * scale;
                ctx.fillText(i + " m", x - 10, groundY + 15);
                ctx.beginPath();
                ctx.moveTo(x, groundY - 5);
                ctx.lineTo(x, groundY + 5);
                ctx.stroke();
            }
            for (let i = 0; i <= height; i++) {
                let y = groundY - i * scale;
                ctx.fillText(i + " m", originX - 35, y + 5);
                ctx.beginPath();
                ctx.moveTo(originX - 5, y);
                ctx.lineTo(originX + 5, y);
                ctx.stroke();
            }
        }
    
        
        // Dynamická deaktivace polí podle režimu NEBO (Zoom a Tilt)
        function updateTiltFields() {
            if (tiltField.value) {
                distanceField.disabled = true;
            } else {
                distanceField.disabled = false;
            }

            if (distanceField.value) {
                tiltField.disabled = true;
            } else {
                tiltField.disabled = false;
            }
        }

        
        const zoomField = document.getElementById("input_zoom");
        const tiltField = document.getElementById("input_tilt");
        const distanceField = document.getElementById("input_distance");

        const zmHeightField = document.getElementById("measured_height");
        const zmDiameterField = document.getElementById("measured_diameter");

        function updateZoomFields() {
            if (zoomField.value) {
                zmHeightField.disabled = true;
                zmDiameterField.disabled = true;
            } else {
                zmHeightField.disabled = false;
                zmDiameterField.disabled = false;
            }

            if (zmHeightField.value || zmDiameterField.value) {
                zoomField.disabled = true;
            } else {
                zoomField.disabled = false;
            }
        }

        
        zoomField.addEventListener("input", updateZoomFields);
        tiltField.addEventListener("input", updateTiltFields);
        distanceField.addEventListener("input", updateTiltFields);

        zmHeightField.addEventListener("input", updateZoomFields);
        zmDiameterField.addEventListener("input", updateZoomFields);

        
        updateZoomFields();
        updateTiltFields();

    </script>

</body>
</html>
